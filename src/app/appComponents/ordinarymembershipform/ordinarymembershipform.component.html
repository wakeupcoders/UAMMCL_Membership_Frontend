<!-- <app-header *ngIf="!isLoading"></app-header> -->


<app-loader *ngIf="isLoading"></app-loader>

<div class="row" *ngIf="!isLoading && ordinaryMembers.length<=0 && isTableView">
  <div class="col-md-4"></div>
  <div class="col-md-4">
    <div class="card text-center">
      <img src="https://assets-v2.lottiefiles.com/a/0e30b444-117c-11ee-9b0d-0fd3804d46cd/BkQxD7wtnZ.gif"
        class="card-img-top mx-auto d-block" alt="No Records">
      <div class="card-body">
        <h3 class="card-title mb-3">No Records Found</h3>
        <p class="card-text mb-4">It looks like there are no records available. You can add new records or contact
          support for assistance.</p>
        <div class="d-flex justify-content-center gap-3">
          <button class="btn btn-dark btn-lg" (click)="showForm(false)">Add Records</button>
          <a href="https://wakeupcoders.com" target="_blank" class="btn btn-secondary btn-lg">Contact Support</a>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-4"></div>
</div>



<div class="container" *ngIf="!isLoading">
  <span *ngIf="!isTableView">
    <form [formGroup]="memberForm" (ngSubmit)="onSubmit()">
      <!-- Applicant Details Card -->
      <div class="shadow-lg p-3 mb-5 bg-white rounded p-3 mb-3">
        <h4>Applicant Details</h4>
        <hr>

        <div class="mb-3">
          <label>Name of Applicant</label>
          <input formControlName="nameOfApplicant" class="form-control" type="text" />
          <div class="text-danger"
            *ngIf="memberForm.get('nameOfApplicant')?.touched && memberForm.get('nameOfApplicant')?.errors?.['required']">
            Name of Applicant is required.
          </div>
        </div>

        <div class="mb-3">
          <label>Membership ID</label>
          <input formControlName="membership_id" class="form-control" type="text" />
          <div class="text-danger"
            *ngIf="memberForm.get('membership_id')?.touched && memberForm.get('membership_id')?.errors?.['required']">
            Membership ID is required.
          </div>
        </div>

        <div class="mb-3">
          <label>State</label>
          <input formControlName="state" class="form-control" type="text" />
          <div class="text-danger"
            *ngIf="memberForm.get('state')?.touched && memberForm.get('state')?.errors?.['required']">
            State is required.
          </div>
        </div>

        <div class="mb-3">
          <label>Resident Of</label>
          <input formControlName="residentOf" class="form-control" type="text" />
          <div class="text-danger"
            *ngIf="memberForm.get('residentOf')?.touched && memberForm.get('residentOf')?.errors?.['required']">
            Resident Address is required.
          </div>
        </div>

        <div class="mb-3">
          <label>Shares</label>
          <input formControlName="shares" class="form-control" type="number" />
          <div class="text-danger"
            *ngIf="memberForm.get('shares')?.touched && memberForm.get('shares')?.errors?.['required']">
            Shares are required.
          </div>
        </div>
      </div>

      <!-- Personal Details Starts Here -->
      <div class="shadow-lg p-3 mb-5 bg-white rounded">

        <h4>Personal Details</h4>
        <hr>

        <div class="mb-3">
          <label>Full Name</label>
          <input formControlName="fullName" class="form-control" type="text" />
          <div class="text-danger"
            *ngIf="memberForm.get('fullName')?.touched && memberForm.get('fullName')?.errors?.['required']">
            Full Name is required.
          </div>
        </div>

        <div class="mb-3">
          <label>Mother's Name</label>
          <input formControlName="motherName" class="form-control" type="text" />
          <div class="text-danger"
            *ngIf="memberForm.get('motherName')?.touched && memberForm.get('motherName')?.errors?.['required']">
            Mother's Name is required.
          </div>
        </div>

        <div class="mb-3">
          <label>Wife's Name</label>
          <input formControlName="wifeName" class="form-control" type="text" />
          <div class="text-danger"
            *ngIf="memberForm.get('wifeName')?.touched && memberForm.get('wifeName')?.errors?.['required']">
            Wife's Name is required.
          </div>
        </div>

        <div class="mb-3">
          <label>Age</label>
          <input formControlName="age" class="form-control" type="number" />
          <div class="text-danger"
            *ngIf="memberForm.get('age')?.touched && memberForm.get('age')?.errors?.['required']">
            Age is required.
          </div>
        </div>

        <div class="mb-3">
          <label>Date of Birth</label>
          <input formControlName="dateOfBirth" class="form-control" type="date" />
          <div class="text-danger"
            *ngIf="memberForm.get('dateOfBirth')?.touched && memberForm.get('dateOfBirth')?.errors?.['required']">
            Date of Birth is required.
          </div>
        </div>

        <div class="mb-3">
          <label>Educational Qualification</label>
          <input formControlName="educationalQualification" class="form-control" type="text" />
          <div class="text-danger"
            *ngIf="memberForm.get('educationalQualification')?.touched && memberForm.get('educationalQualification')?.errors?.['required']">
            Educational Qualification is required.
          </div>
        </div>

        <div class="mb-3">
          <label>Marital Status</label>
          <select formControlName="maritalStatus" class="form-control">
            <option value="">Select</option>
            <option value="Single">Single</option>
            <option value="Married">Married</option>
            <option value="Divorced">Divorced</option>
          </select>
          <div class="text-danger"
            *ngIf="memberForm.get('maritalStatus')?.touched && memberForm.get('maritalStatus')?.errors?.['required']">
            Marital Status is required.
          </div>
        </div>

        <div class="mb-3">
          <label>Permanent Address</label>
          <input formControlName="permanentAddress" class="form-control" type="text" />
          <div class="text-danger"
            *ngIf="memberForm.get('permanentAddress')?.touched && memberForm.get('permanentAddress')?.errors?.['required']">
            Permanent Address is required.
          </div>
        </div>

        <div class="mb-3">
          <label>Permanent Pin Code</label>
          <input formControlName="permanentPinCode" class="form-control" type="number" />
          <div class="text-danger"
            *ngIf="memberForm.get('permanentPinCode')?.touched && memberForm.get('permanentPinCode')?.errors?.['required']">
            Permanent Pin Code is required.
          </div>
        </div>

        <div class="mb-3">
          <label>Present Address</label>
          <input formControlName="presentAddress" class="form-control" type="text" />
          <div class="text-danger"
            *ngIf="memberForm.get('presentAddress')?.touched && memberForm.get('presentAddress')?.errors?.['required']">
            Present Address is required.
          </div>
        </div>

        <div class="mb-3">
          <label>Present Pin Code</label>
          <input formControlName="presentPinCode" class="form-control" type="number" />
          <div class="text-danger"
            *ngIf="memberForm.get('presentPinCode')?.touched && memberForm.get('presentPinCode')?.errors?.['required']">
            Present Pin Code is required.
          </div>
        </div>

        <div class="mb-3">
          <label>Telephone Number</label>
          <input formControlName="telephoneNumber" class="form-control" type="text" />
          <div class="text-danger"
            *ngIf="memberForm.get('telephoneNumber')?.touched && memberForm.get('telephoneNumber')?.errors?.['required']">
            Telephone Number is required.
          </div>
        </div>

        <div class="mb-3">
          <label>Email</label>
          <input formControlName="email" class="form-control" type="email" />
          <div class="text-danger"
            *ngIf="memberForm.get('email')?.touched && memberForm.get('email')?.errors?.['required']">
            Email is required.
          </div>
        </div>

        <div class="mb-3">
          <label>Aadhar Card</label>
          <input formControlName="aadharCard" class="form-control" type="text" />
          <div class="text-danger"
            *ngIf="memberForm.get('aadharCard')?.touched && memberForm.get('aadharCard')?.errors?.['required']">
            Aadhar Card is required.
          </div>
        </div>

        <div class="mb-3">
          <label>PAN Card</label>
          <input formControlName="panCard" class="form-control" type="text" />
          <div class="text-danger"
            *ngIf="memberForm.get('panCard')?.touched && memberForm.get('panCard')?.errors?.['required']">
            PAN Card is required.
          </div>
        </div>

      </div>


      <!-- Nomination Details Card -->
      <div class="shadow-lg p-3 mb-5 bg-white rounded p-3 mb-3">
        <h5>Nomination Details</h5>
        <div formGroupName="nomination">
          <div class="mb-3">
            <label>Name</label>
            <input formControlName="name" class="form-control" type="text" />
            <div class="text-danger"
              *ngIf="memberForm.get('nomination.name')?.touched && memberForm.get('nomination.name')?.errors?.['required']">
              Nominee Name is required.
            </div>
          </div>

          <div class="mb-3">
            <label>Relation</label>
            <input formControlName="relation" class="form-control" type="text" />
            <div class="text-danger"
              *ngIf="memberForm.get('nomination.relation')?.touched && memberForm.get('nomination.relation')?.errors?.['required']">
              Relation is required.
            </div>
          </div>

          <div class="mb-3">
            <label>Occupation</label>
            <input formControlName="occupation" class="form-control" type="text" />
            <div class="text-danger"
              *ngIf="memberForm.get('nomination.occupation')?.touched && memberForm.get('nomination.occupation')?.errors?.['required']">
              Occupation is required.
            </div>
          </div>

          <div class="mb-3">
            <label>Address</label>
            <input formControlName="address" class="form-control" type="text" />
            <div class="text-danger"
              *ngIf="memberForm.get('nomination.address')?.touched && memberForm.get('nomination.address')?.errors?.['required']">
              Address is required.
            </div>
          </div>

          <div class="mb-3">
            <label>Age</label>
            <input formControlName="age" class="form-control" type="number" />
            <div class="text-danger"
              *ngIf="memberForm.get('nomination.age')?.touched && memberForm.get('nomination.age')?.errors?.['required']">
              Age is required.
            </div>
          </div>
        </div>
      </div>


      <!-- Certificate Details Card -->
      <div class="shadow-lg p-3 mb-5 bg-white rounded p-3 mb-3">
        <h5>Certificate Details</h5>
        <div formGroupName="certificateDetails">
          <div class="mb-3">
            <label>Register Number</label>
            <input formControlName="register_number" class="form-control" type="text" />
            <div class="text-danger"
              *ngIf="memberForm.get('certificateDetails.register_number')?.touched && memberForm.get('certificateDetails.register_number')?.errors?.['required']">
              Register Number is required.
            </div>
          </div>

          <div class="mb-3">
            <label>Certificate Number</label>
            <input formControlName="certificate_number" class="form-control" type="text" />
            <div class="text-danger"
              *ngIf="memberForm.get('certificateDetails.certificate_number')?.touched && memberForm.get('certificateDetails.certificate_number')?.errors?.['required']">
              Certificate Number is required.
            </div>
          </div>

          <div class="mb-3">
            <label>Holding Identification Number</label>
            <input formControlName="Holding_Iden_number" class="form-control" type="text" />
            <div class="text-danger"
              *ngIf="memberForm.get('certificateDetails.Holding_Iden_number')?.touched && memberForm.get('certificateDetails.Holding_Iden_number')?.errors?.['required']">
              Holding Identification Number is required.
            </div>
          </div>

          <div class="mb-3">
            <label>Share Start Number</label>
            <input formControlName="share_start_number" class="form-control" type="number" />
            <div class="text-danger"
              *ngIf="memberForm.get('certificateDetails.share_start_number')?.touched && memberForm.get('certificateDetails.share_start_number')?.errors?.['required']">
              Share Start Number is required.
            </div>
          </div>

          <div class="mb-3">
            <label>Share End Number</label>
            <input formControlName="share_end_number" class="form-control" type="number" />
            <div class="text-danger"
              *ngIf="memberForm.get('certificateDetails.share_end_number')?.touched && memberForm.get('certificateDetails.share_end_number')?.errors?.['required']">
              Share End Number is required.
            </div>
          </div>


          <!-- <div class="mb-3">
            <label>Value of Share</label>
            <input formControlName="value_of_share" class="form-control" type="text"/>
            <div class="text-danger"
              *ngIf="memberForm.get('certificateDetails.value_of_share')?.touched && memberForm.get('certificateDetails.value_of_share')?.errors?.['required']">
              Value of Share is required.
            </div>
          </div> -->

        </div>
      </div>




      <div class="  shadow-lg p-3 mb-5 bg-white rounded p-3">
        <h5>Payment Details</h5>

        <div class="mb-3">
          <label>Receipt Number</label>
          <input formControlName="receiptNumber" class="form-control" type="number" />
          <div class="text-danger"
            *ngIf="memberForm.get('receiptNumber')?.touched && memberForm.get('receiptNumber')?.errors?.['required']">
            Receipt Number is required.
          </div>
          <div class="text-danger"
            *ngIf="memberForm.get('receiptNumber')?.touched && memberForm.get('receiptNumber')?.errors?.['min']">
            Receipt Number must be greater than 0.
          </div>
        </div>

        <div class="mb-3">
          <label>Payment Mode</label>
          <select formControlName="paymentMode" class="form-control">
            <option value="">Select</option>
            <option value="NEFT">NEFT</option>
            <option value="IMPS">IMPS</option>
            <option value="RTGS">RTGS</option>
            <option value="CHEQUE">CHEQUE</option>
            <option value="DEMAND DRAFT">DEMAND DRAFT</option>
            <option value="CASH">CASH</option>
            <option value="UPI">UPI</option>
            <option value="OTHERS">OTHERS</option>
          </select>
          <div class="text-danger"
            *ngIf="memberForm.get('maritalStatus')?.touched && memberForm.get('maritalStatus')?.errors?.['required']">
            Marital Status is required.
          </div>
        </div>
      </div>


      <div class="shadow-lg p-3 mb-5 bg-white rounded p-3 mb-3 mb-3" *ngIf="editMode==true">
        <label>Attachments</label>
        <div class="file-upload">
          <input type="file" (change)="onFileSelected($event)" />
          <a (click)="uploadFile()" class="btn btn-dark">Upload</a>
          <p class="text-success">{{uploadMessage}}</p>
        </div>

        <hr>
        <div class="file-card" *ngFor="let attachment of selectedMember.attachments">
          <div class="file-info">
            <p>{{attachment}}</p>
          </div>
          <div class="file-actions">
            <a class="btn btn-dark" (click)="onView(attachment)">View</a>
            <a class="btn btn-danger" (click)="onDeleteAttachment(attachment)">Delete</a>
          </div>
        </div>


      </div>

      <!-- Submit Button -->
      <button class="btn btn-dark" type="submit" [disabled]="memberForm.invalid">Submit</button>
      <button class="btn btn-danger" (click)="showForm(true)">Cancel</button>
    </form>
  </span>

  <div class="container mt-4" *ngIf="isTableView && ordinaryMembers.length>0">
    <h2>Ordinary Membership Data</h2>


    <div class="btn-group" role="group" aria-label="Basic example">

      <button class="btn btn-success" (click)="showForm(false)">New</button>

      <!-- Input field with a template reference variable -->
      <input #inputValue type="text" class="form-control" placeholder="Enter Member Id" />
      <!-- Button triggers the redirect method -->
      <button class="btn btn-primary" (click)="redirectToReport(inputValue.value)">
        Export
      </button>


    </div>

    <!-- <a class="btn btn-primary" href="https://uammcl-membership-backend.onrender.com/api/reports/downloadOM"
        target="_blank">Export</a> -->



    <br><br>



    <div class="table-responsive">
      <table class="table table-bordered table-striped">
        <thead class="thead-dark">
          <tr>
            <th>Reg#</th>
            <th>Cert#</th>
            <th>Name</th>
            <th>Member#</th>
            <th>State</th>
            <th>Shares</th>
            <th>Value</th>
            <th>Total </th>
            <th>Start</th>
            <th>End</th>
            <th>Date</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let member of ordinaryMembers | paginate: { itemsPerPage: 10, currentPage: p }">
            <td>{{member["certificateDetails"].register_number}}</td>
            <td>{{member["certificateDetails"].certificate_number}}</td>
            <td>{{member.nameOfApplicant}}</td>
            <td>{{member.membership_id}}</td>
            <td>{{member.state}}</td>
            <td>{{member.shares}}</td>
            <td>{{member["certificateDetails"].value_of_share}}</td>
            <td>{{member.shares * member["certificateDetails"].value_of_share}}</td>
            <td>{{member["certificateDetails"].share_start_number}}</td>
            <td>{{member["certificateDetails"].share_end_number}}</td>
            <td>{{member.createdAt | date: 'dd, MMMM yyyy'}}</td>
            <!-- <td>{{member.createdAt | date: 'yyyy'}}</td> -->
            <td>
              <div class="btn-group" role="group" aria-label="Basic example">
                <button class="btn btn-primary btn-sm" (click)="onEditMember(member)"><svg
                    xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    class="bi bi-gear-fill" viewBox="0 0 16 16">
                    <path
                      d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z" />
                  </svg></button>
                <button class="btn btn-danger btn-sm" (click)="deletePopup(member._id)"><svg
                    xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    class="bi bi-trash-fill" viewBox="0 0 16 16">
                    <path
                      d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5M8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5m3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0" />
                  </svg></button>
                <button class="btn btn-secondary btn-sm" (click)="onGenerateCertificate(member._id)"><svg
                    xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-receipt"
                    viewBox="0 0 16 16">
                    <path
                      d="M1.92.506a.5.5 0 0 1 .434.14L3 1.293l.646-.647a.5.5 0 0 1 .708 0L5 1.293l.646-.647a.5.5 0 0 1 .708 0L7 1.293l.646-.647a.5.5 0 0 1 .708 0L9 1.293l.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .801.13l.5 1A.5.5 0 0 1 15 2v12a.5.5 0 0 1-.053.224l-.5 1a.5.5 0 0 1-.8.13L13 14.707l-.646.647a.5.5 0 0 1-.708 0L11 14.707l-.646.647a.5.5 0 0 1-.708 0L9 14.707l-.646.647a.5.5 0 0 1-.708 0L7 14.707l-.646.647a.5.5 0 0 1-.708 0L5 14.707l-.646.647a.5.5 0 0 1-.708 0L3 14.707l-.646.647a.5.5 0 0 1-.801-.13l-.5-1A.5.5 0 0 1 1 14V2a.5.5 0 0 1 .053-.224l.5-1a.5.5 0 0 1 .367-.27m.217 1.338L2 2.118v11.764l.137.274.51-.51a.5.5 0 0 1 .707 0l.646.647.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.509.509.137-.274V2.118l-.137-.274-.51.51a.5.5 0 0 1-.707 0L12 1.707l-.646.647a.5.5 0 0 1-.708 0L10 1.707l-.646.647a.5.5 0 0 1-.708 0L8 1.707l-.646.647a.5.5 0 0 1-.708 0L6 1.707l-.646.647a.5.5 0 0 1-.708 0L4 1.707l-.646.647a.5.5 0 0 1-.708 0z" />
                    <path
                      d="M3 4.5a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5m8-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5" />
                  </svg></button>


                <button class="btn btn-success btn-sm" [routerLink]="['/viewordinary', member._id]"><svg
                    xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye"
                    viewBox="0 0 16 16">
                    <path
                      d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z" />
                    <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0" />
                  </svg></button>
              </div>
            </td>
          </tr>
          <!-- Add more rows as needed -->
        </tbody>
      </table>

      <pagination-controls (pageChange)="p = $event"></pagination-controls>
    </div>
  </div>

</div>


<!-- <app-footer *ngIf="!isLoading"></app-footer> -->